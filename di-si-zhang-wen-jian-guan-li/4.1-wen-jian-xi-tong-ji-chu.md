# 4.1 文件系统基础

## 4.1.1 文件的概念

### 1、文件的定义

一组有意义的信息的集合

### 2、文件的属性

**文件名**：由创建文件的用户决定，同一目录下不允许存在相同的文件名

**标识符**：系统内各文件的唯一标签，对于用户而言不可见

**类型**：文件的类型

**位置**：文件存放的路径（对用户而言）、在外存中的地址信息（对操作系统而言）

**保护信息**：对文件进行访问控制用的信息

**创建时间**、**修改时间**等。

### 3、操作系统提供的相关功能

* 创建文件（create系统调用）
* 删除文件（delete系统调用）
* 读文件（read系统调用）
* 写文件（write系统调用）
* 打开文件（open系统调用）
* 关闭文件（close系统调用）

## 4.1.2 文件的逻辑结构

**逻辑结构**：在用户看来，文件内部的数据应该是如何组织起来的

**物理结构**：在操作系统看来，文件 的数据是如何存放在外存中的

### 1、无结构文件

文件内部的数据就是一系列二进制流或字符流组成。又称**流式文件**，如：Windows操作系统中的.txt文件、mp3文件等。

### 2、有结构文件

由一组相似的记录组成，又称**记录式文件**。每条记录又若干个数据项组成。如：数据库表文件，CSV文件等。一般来说，每条记录有一个数据项可作为**关键字**（作为识别不同记录的ID）。

根据每条记录的长度是否相等，可以分为**定长记录**和**可变长记录**两种。

有结构文件的**逻辑结构**可以分为以下三种：

#### （1）顺序文件

文件中的记录一个接一个地**顺序排列（逻辑上）**，记录可以是定长的或可变长的。

顺序文件可以有以下存储方式：

* 链式存储：（逻辑上相邻、物理上不相邻）无论是定长/可变长记录，都**只能依次查找**，无法实现随机存取
* 顺序存储：（逻辑上相邻、物理上也相邻）
  * 可变长记录：无法实现随机存储
  * 定长记录：可以实现随机存储。记录长度为L，则第i个记录的相对位置就是 i \* L
    * 若采用串结构；（记录之间的顺序与关键字无关，一般按照记录时间排序）无法快速找到对应关键字的记录
    * 若采用顺序结构：（记录之间按照关键字排列）可以迅速查找到相应关键字对应的记录

{% hint style="danger" %}
考试中一般提到顺序文件默认为**顺序存储的顺序文件**
{% endhint %}

**顺序文件实现增删改查较为困难**

#### （2）索引文件

索引表本身是定长记录的顺序文件。因此可以快速找到第i个记录对应的索引项。 

可将关键字作为索引号内容，若按关键字顺序排列，则还可以支持按照关键字折半查找。

每当要增加/删除一个记录时，需要对索引表进行修改。由于索引文件有很快的检索速度，因此**主要用于对信息处理的及时性要求比较高的场合**。

同时，可以对不同的数据项建立多个索引表，方便查找。

缺点：当记录数量增大时，索引表的大小也会变大，甚至可能出现索引表比文件本身还大的情况

#### （3）索引顺序文件

索引顺序文件是索引文件和顺序文件思想的结合。索引顺序文件中，同样会为文件建立一张索引表，但不同的是：并不是每个记录对应一个索引表项，而是**一组记录**对应**一个索引表项**。

即，将文件分为若干组顺序文件，查找时先通过索引表找到所在的顺序文件，再通过顺序检索找到相应的记录。

## 4.1.3 目录结构

### 1、文件控制块

文件控制块（FCB）：**FCB的有序集合称为文件目录**，一个FCB就是一个文件目录项

FCB中包含了文件的：

* 基本信息（文件名、物理地址、逻辑结构、物理结构等）
* 存取控制信息（是否可读/可写、禁止访问的用户名单等）
* 使用信息（如文件的建立时间、修改时间等）。

### 2、目录结构

用户需要对目录进行的操作：

* **搜索**：当用户要使用一个文件时，系统要根据文件名搜索目录，找到该文件对应的目录项
* **创建文件**：创建一个新文件时，需要在其所属的目录中增加一个目录项
* **删除文件**：当删除一个文件时，需要在目录中删除相应的目录项
* **显示目录**：用户可以请求显示目录的内容，如显示该目录中的所有文件及相应属性

目录有以下几种结构：

#### （1）单级目录结构

整个系统中只建立一张目录表，每个文件占一个目录项。

* 优点
  * 实现了按名存取
* 缺点
  * 不允许文件重名
  * 不适用于多用户操作系统

#### （2）两级目录结构

