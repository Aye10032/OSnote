# 2.2 处理机调度

## 2.2.1 调度的概念、层次

### 一、调度的概念

{% hint style="success" %}
在处理机调度是对处理机进行分配，即从就绪队列中按照一定的算法选择一个进程并将处理机分配给它运行，以实现进程并发地执行。
{% endhint %}

**处理机调度是多道程序操作系统的基础，是操作系统设计的核心问题。**

### 二、调度的层次

#### 1、作业调度（高级调度）

{% hint style="info" %}
按照一定原则从外村上处于后备队列的作业中选择一个（或多个），给它分配内存等必要资源，并**建立相应的进程（建立PCB）**，以使它获得**竞争处理机资源的权利**。
{% endhint %}

作业调度是外存和内存之间的调度。每个作业只调入一次、调出一次。作业调度时建立相应的PCB；作业调出时撤销相应的PCB。

#### 2、内存调度（中级调度）

{% hint style="info" %}
可以将暂时不能运行的进程调值外存等待。这些进程会进入“**挂起状态**”，其PCB仍然**常驻在内存**，被放入到挂起队列中。其目的是**提高内存利用率和系统吞吐量**。
{% endhint %}

**通过中级调度来决定将哪个处于挂起状态的进程重新调入内存中**。

#### 3、进程调度（低级调度）

{% hint style="info" %}
按照某种方法和策略从就绪队列中选择一个进程，将处理机分配给它。
{% endhint %}

进程调度是操作系统中**最基本的一种调度**。其**频率很高**，一般几十毫秒一次。

|  | 调度发生在 | 进程状态变化 |
| :---: | :---: | :---: |
| 高级调度 | 外存→内存（面向作业） | 无→创建态→就绪态 |
| 中级调度 | 外存→内存（面向进程） | 挂起态→就绪态（阻塞挂起→阻塞态） |
| 低级调度 | 内存→CPU | 就绪态→挂起态 |

## 2.2.2 调度的时机、切换与过程

### 一、进程调度的时机

#### 需要进行进程调度的情况

* 当前进程**主动**放弃处理机资源
  * 进程正常中止
  * 进程出现异常终止
  * 进程主动请求阻塞
* 当前进程**被动**放弃处理机资源
  * 分配的时间片用完
  * 有更紧急的事件要处理（如I/O中断）
  * 有更高优先级的进程进入就绪队列

#### 不能进行进程调度与切换的情况

* 在处理中断的过程中
* 进程处于**操作系统内核程序临界区**中
* 在进行原子操作的过程中（**原语**）。

{% hint style="info" %}
**临界资源**：一个时间段内只允许一个进程使用的资源，各进程需要**互斥地**访问临界资源。

**临界区**：访问临界资源的那段代码。

**内核程序临界区**：一般是用于访问**内核数据结构**的，例如进程的就绪队列。
{% endhint %}



