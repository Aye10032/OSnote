# 2.2 处理机调度

## 2.2.1 调度的概念、层次

### 一、调度的概念

{% hint style="success" %}
在处理机调度是对处理机进行分配，即从就绪队列中按照一定的算法选择一个进程并将处理机分配给它运行，以实现进程并发地执行。
{% endhint %}

**处理机调度是多道程序操作系统的基础，是操作系统设计的核心问题。**

### 二、调度的层次

#### 1、作业调度（高级调度）

{% hint style="info" %}
按照一定原则从外村上处于后备队列的作业中选择一个（或多个），给它分配内存等必要资源，并**建立相应的进程（建立PCB）**，以使它获得**竞争处理机资源的权利**。
{% endhint %}

作业调度是外存和内存之间的调度。每个作业只调入一次、调出一次。作业调度时建立相应的PCB；作业调出时撤销相应的PCB。

#### 2、内存调度（中级调度）

{% hint style="info" %}
可以将暂时不能运行的进程调值外存等待。这些进程会进入“**挂起状态**”，其PCB仍然**常驻在内存**，被放入到挂起队列中。其目的是**提高内存利用率和系统吞吐量**。
{% endhint %}

**通过中级调度来决定将哪个处于挂起状态的进程重新调入内存中**。

#### 3、进程调度（低级调度）

{% hint style="info" %}
按照某种方法和策略从就绪队列中选择一个进程，将处理机分配给它。
{% endhint %}

进程调度是操作系统中**最基本的一种调度**。其**频率很高**，一般几十毫秒一次。

|  | 调度发生在 | 进程状态变化 |
| :---: | :---: | :---: |
| 高级调度 | 外存→内存（面向作业） | 无→创建态→就绪态 |
| 中级调度 | 外存→内存（面向进程） | 挂起态→就绪态（阻塞挂起→阻塞态） |
| 低级调度 | 内存→CPU | 就绪态→挂起态 |

## 2.2.2 调度的时机、切换与过程

### 一、进程调度的时机

#### 需要进行进程调度的情况

* 当前进程**主动**放弃处理机资源
  * 进程正常中止
  * 进程出现异常终止
  * 进程主动请求阻塞
* 当前进程**被动**放弃处理机资源
  * 分配的时间片用完
  * 有更紧急的事件要处理（如I/O中断）
  * 有更高优先级的进程进入就绪队列

#### 不能进行进程调度与切换的情况

* 在处理中断的过程中
* 进程处于**操作系统内核程序临界区**中
* 在进行原子操作的过程中（**原语**）。

{% hint style="info" %}
**临界资源**：一个时间段内只允许一个进程使用的资源，各进程需要**互斥地**访问临界资源。

**临界区**：访问临界资源的那段代码。

**内核程序临界区**：一般是用于访问**内核数据结构**的，例如进程的就绪队列。
{% endhint %}

### 二、进程调度的方式

#### 非剥夺调度方式（非抢占方式）

只允许进程主动放弃处理机资源。即便有更高优先级的任务到达，也要等待当前进程主动终止或进入阻塞态。

* 实现简单，系统开销小
* 无法及时处理紧急任务

#### 剥夺调度方式（抢占方式）

当有更重要的任务需要使用处理机时，立即暂停当前正在执行的进程，将处理机资源给更紧迫的任务。

* 可以优先处理更紧急的任务
* 可以让各进程按照时间片轮流执行
* 适用于分时操作系统、实时操作系统

### 三、进程的切换与过程

#### 狭义的进程调度与进程切换

**狭义的进程调度**：从就绪队列中**选中一个要运行的进程**。这个进程可以是刚刚被暂停执行的进程，也可以是**另一个进程**，后者就需要**进程切换**。

**进程切换**：一个进程让出处理机，由另一个进程占用处理机的过程。



**广义的进程调度**包含了选择进程和进程切换两个步骤。

#### 进程切换中实现了什么

* 对原来进程的各种数据进行保存
* 对新的进程进行各种数据的恢复

**进程的切换是有代价的**，过于频繁的进行进程的调度、切换会使得操作系统的效率降低。

## 2.2.3 进程调度的基本准则

### 一、CPU利用率

$$
利用率 = \frac{忙碌的时间}{总时间}
$$

设备利用率同理

### 二、系统吞吐量

$$
系统吞吐量 = \frac{完成的作业数}{总计时间}
$$

### 三、周转时间

